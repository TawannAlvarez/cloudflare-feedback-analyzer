# AI Agent Instructions — Cloudflare Feedback Analyzer

Purpose: Give an AI coding agent the exact, discoverable knowledge needed to be productive in this repository.

Overview
- **What this is:** A Cloudflare Workers TypeScript starter that analyzes feedback. The entrypoint is the Worker handler in `src/index.ts` which exports an `async fetch(request, env, ctx)` handler typed as `ExportedHandler<Env>`.
- **Runtime:** Cloudflare Workers (Wrangler), strict TypeScript, no emitted bundles (`noEmit: true`). Types for bindings are generated into `worker-configuration.d.ts` by `wrangler types` / `npm run cf-typegen`.

Key Files
- `src/index.ts`: main Worker handler — use `ctx.waitUntil()` for background tasks and always return `Promise<Response>`.
- `wrangler.jsonc`: environment metadata and bindings. Update this to add KV, D1, or service bindings.
- `worker-configuration.d.ts`: generated types for `Env` — do NOT edit manually; run `npm run cf-typegen` after changing `wrangler.jsonc`.
- `test/index.spec.ts`: demonstrates both unit-style (`createExecutionContext()`) and integration-style (`SELF.fetch()`) tests using `@cloudflare/vitest-pool-workers`.
- `src/mockFeedback.json`: example input data used by tests and local dev.

Developer Workflows (commands)
- Local dev (auto-reloads the Worker): `npm run dev` (serves at http://localhost:8787/)
- Run tests (Vitest with Cloudflare Worker pool): `npm run test`
- Regenerate Worker binding types: `npm run cf-typegen`
- Deploy: `npm run deploy` (requires Wrangler auth)

Project Conventions & Patterns
- **Handler signature:** Always implement `(request, env, ctx): Promise<Response>` with `ExportedHandler<Env>` typing. See `src/index.ts`.
- **Strict types / noEmit:** TS is strict; runtime artifacts are not emitted. Rely on `worker-configuration.d.ts` for binding types.
- **Testing patterns:** Prefer the patterns shown in `test/index.spec.ts`:
  - `createExecutionContext()` for unit-like handler tests
  - `SELF.fetch()` for end-to-end worker simulation
- **Background tasks:** Use `ctx.waitUntil()` for fire-and-forget work — tests may stub or assert behavior accordingly.

Integration Points & Dependencies
- Uses Cloudflare runtime (Workers). Any external services or KVs must be declared in `wrangler.jsonc` and then typed via `npm run cf-typegen`.
- Tests depend on `@cloudflare/vitest-pool-workers` — follow the examples in `test/index.spec.ts` to simulate the Worker environment.

What to change and how
- To add a new binding: edit `wrangler.jsonc` → `npm run cf-typegen` → update code to use `env.MY_BINDING`.
- To add a new test style: mirror patterns in `test/index.spec.ts` so the Worker pool can simulate runtime correctly.

Notes for AI agents (practical tips)
- Check `wrangler.jsonc` and `worker-configuration.d.ts` first when modifying `Env` bindings.
- Prefer minimal, focused changes: fix the root cause rather than broad refactors.
- Preserve test patterns; when adding features, add matching tests using the pool worker examples.
- Do not modify `worker-configuration.d.ts` directly — it will be overwritten.

If anything in these notes is unclear or you want more examples (e.g., a new binding + test flow), ask and I will expand the relevant section.
# AI Agent Instructions for Cloudflare Feedback Analyzer

## Project Overview
This is a **Cloudflare Workers** project built with TypeScript, Wrangler, and Vitest. The project is a starter Worker template (currently returning "Hello World!") designed for feedback analysis on Cloudflare's platform.

**Key Stack:**
- Cloudflare Workers (edge computing)
- TypeScript (strict mode enabled)
- Wrangler 4.59+ (CLI & config management)
- Vitest ~3.2 + @cloudflare/vitest-pool-workers (testing)

## Architecture & Critical Patterns

### Worker Entry Point
The main worker handler is in [src/index.ts](src/index.ts):
- Implements `ExportedHandler<Env>` interface
- Exports a default object with `async fetch(request, env, ctx)` method
- Returns a `Promise<Response>`
- The `env` parameter provides access to bindings (databases, KV, AI, etc.) - currently empty but extensible via [wrangler.jsonc](wrangler.jsonc)

### Configuration & Environment
- **[wrangler.jsonc](wrangler.jsonc)** defines the Worker metadata and bindings (environment variables, service bindings, static assets)
- **Compatibility date**: 2025-09-27 (can be updated for new runtime features)
- **Observability**: Enabled by default
- Type definitions regenerate automatically: run `npm run cf-typegen` after adding bindings in wrangler.jsonc

### Type System
- **Main tsconfig** ([tsconfig.json](tsconfig.json)): Targets ES2024, strict mode, excludes tests
- **Test tsconfig** ([test/tsconfig.json](test/tsconfig.json)): Extends main config, includes Vitest pool types
- **Auto-generated types**: [worker-configuration.d.ts](worker-configuration.d.ts) is generated by `wrangler types` - **never edit manually**
- Type globals: `Env`, `ExportedHandler` available globally via worker-configuration.d.ts

## Development Workflows

### Common Commands
```bash
npm run dev          # Start local development server (http://localhost:8787/)
npm run test         # Run Vitest suite with Workers pool
npm run deploy       # Deploy to Cloudflare (requires auth)
npm run cf-typegen   # Regenerate type definitions after binding changes
```

### Testing Strategy
- Test file: [test/index.spec.ts](test/index.spec.ts)
- Uses `@cloudflare/vitest-pool-workers` for true Worker runtime simulation
- Two testing patterns demonstrated:
  1. **Unit style**: Direct `worker.fetch()` calls with `createExecutionContext()`
  2. **Integration style**: `SELF.fetch()` for full Worker simulation
- Both patterns test the same handler; choose based on testing needs

### Adding Bindings
To add a binding (e.g., Database, KV, AI):
1. Define in [wrangler.jsonc](wrangler.jsonc) under `bindings` or `services`
2. Run `npm run cf-typegen` to regenerate [worker-configuration.d.ts](worker-configuration.d.ts)
3. Access via `env.BINDING_NAME` in fetch handler - types auto-complete

## Project-Specific Conventions

- **Handler signature**: Always use `(request, env, ctx): Promise<Response>` - typing via `ExportedHandler<Env>`
- **Strict TypeScript**: No implicit any; all external data typed explicitly
- **No output files**: `noEmit: true` in tsconfig - Worker is a transpile-only target
- **JSON imports**: `resolveJsonModule: true` enabled; safe to import .json files
- **Testing isolation**: Each test gets fresh `env` and `ctx` via Vitest pool - no shared state

## Integration & Data Flow

```
HTTP Request → Worker fetch handler → env bindings (KV/DB/AI/etc) → Response
```

- Requests come through Cloudflare's global network to the Worker edge location
- Use `env` to access all Cloudflare resources (databases, AI models, object storage, etc.)
- No lifecycle hooks beyond `fetch`; use `ctx.waitUntil()` for background tasks

## Common Tasks

**Modify the handler**: Edit [src/index.ts](src/index.ts) directly; changes auto-reload in dev mode  
**Add environment config**: Update [wrangler.jsonc](wrangler.jsonc) and run `npm run cf-typegen`  
**Add tests**: Create new `.spec.ts` files in [test/](test/) using same patterns as [test/index.spec.ts](test/index.spec.ts)  
**Debug locally**: Use `npm run dev` and browser DevTools or curl; check Wrangler terminal logs
